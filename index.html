
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Randomly generate a five day recipe plan">
    <meta name="author" content="">
    <link rel="shortcut icon" href="img/favicon.ico">
    <title>DinnerSpinner</title>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="js/analytics.js" async></script>
    <style>
      body {
        padding-top: 20px;
        padding-bottom: 20px;
      }
      .navbar {
        margin-bottom: 20px;
      }
      .navbar-right {
        margin-top: 15px;
      }
      .jumbotron {
        text-align: center;
        background-color: white;
      }
      .btn-success {
        margin-bottom: 70px;
      }
      .btn-xs {
        padding: 13px 10px;
        border-radius: 23px;
      }
      .navbar-brand img {
        margin-top: -5px;
      }
      .thumbnail:hover {
        border-color: #66afe9;
        outline: 0;
        -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);
        box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);
      }
      a:hover {
        text-decoration: none;
      }
      .col-md-4 {
        padding-top: 20px;
      }
      @media screen and (max-width: 768px) {
        .nav li {
          padding-top: 15px;
          padding-left: 15px;
        }
      }
      @media only screen and (min-device-width : 768px) and (max-device-width : 1024px) and (-webkit-min-device-pixel-ratio: 2) { 
        .nav li {
            padding-top: 15px;
            padding-left: 15px;
        }
        .navbar-nav {
          float: left;
          margin-top: 0;
          margin-bottom: 0;
        }
      }
    </style>
    <script src="//www.parsecdn.com/js/parse-1.2.18.min.js"></script>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=787404317938843&version=v2.0";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>

    <div class="container">

      <!-- Static navbar -->
      <div class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://jtolla.github.io/dinner-spinner/">DinnerSpinner <img src="img/logoimg.png" width="30px" /></a>
          </div>
          <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
              <li>
                <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jtolla.github.io/dinner-spinner/" data-text="Randomly generated meals!" data-hashtags="dinnerspinner" data-dnt="true">Tweet</a>
                <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
              </li>
              <li style="padding-right:30px">
                <div class="fb-like" data-href="http://jtolla.github.io/dinner-spinner/" data-layout="button_count" data-action="like" data-show-faces="false" data-share="false"></div>
              </li>
              <li>
                <div class="g-plusone" data-size="medium" data-href="http://jtolla.github.io/dinner-spinner/"></div>
              </li>
            </ul>
          </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
      </div>

      <div class="jumbotron">
        <h1>Find great meals!</h1>
        <p>Not sure what to make for dinner?</p>
        <div class="container">
          <p>
            <a class="btn btn-lg btn-success" href="#spin" role="button">Spin!</a>
          </p>
          <hr>
          <div class="row">
            <div class="col-md-4">
              <h4>Step 1</h4>
              <p>Click spin!</p>
            </div>
            <div class="col-md-4">
              <h4>Step 2</h4>
              <p>Hold your favorite recipes.</p>
            </div>
            <div class="col-md-4">
              <h4>Step 3</h4>
              <p>Re-spin until you get a full week of recipes you love. <span class="glyphicon glyphicon-heart"></span></p>
            </div>
          </div>
        </div>
      </div>

      <footer class="well">
        <small><span class="text-muted">&copy; 2014 All Rights Reserved.</span></small>
        <small class="pull-right"><span class="text-muted">Contact:</span> <a href="http://twitter.com/dinner_spinner">@dinner_spinner</a></small>  
      </footer>

    </div> <!-- /container -->

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>
    <script src="js/bootstrap.min.js" async></script>
    <script>

        Parse.initialize("AzsMQJINkoiTEpLlDi13enZzmOnGMxS8aMqn8hzG", "EAUJFOuO0Spez1zc5mbQW7F41NuSaX1aBvhv0M8g");

        var Recipes = Parse.Collection.extend({
            model: 'Recipe'
        });

        var Recipe = Parse.Object.extend({
            className: 'Recipes'
        });

        var SpinResults = Backbone.View.extend({
          el: '.jumbotron .container',
            render: function() {
              var that = this;
              var recipes = new Recipes();
              var query = new Parse.Query(Recipe);
              var ranNums = [];
              query.count({
                success: function(count) {
                  while(ranNums.length < 5){
                    var randomnumber = Math.floor(Math.random() * count);
                    var found = false;
                    for (var i=0; i < ranNums.length; i++){
                      if (ranNums[i] == randomnumber) {
                        found = true;
                        break;
                      }
                    }
                    if (!found) {
                      ranNums[ranNums.length] = randomnumber;
                    }
                  }
                },
                error: function(error) {
                  alert("Oops! There was an error.");
                }
              });
              var recipeLinks = [];
              var recipeNames = [];
              var recipeImages = [];
              var dayOfWeek = ["Fri","Thu","Wed","Tue","Mon"];
              var counter = 0;
              query.find().then(function(results) {
                that.$el.fadeOut(function() {
                  that.$el.html("<p><a class='btn btn-lg btn-success re-spin' href='#' role='button'>Re-Spin!</a></p><hr><div class='container'><div class='row'><div class='col-md-1' id='spinResults'></div><div class='col-md-1'></div></div></div>"); 
                  _(results).each(function(recipe) {
                    recipeLinks.push(recipe.get("link"));
                    recipeNames.push(recipe.get("name"));
                    recipeImages.push(recipe.get("image").url());
                  });
                  for (var i = 0; i < 5; i++) {
                    $("#spinResults").after("<div id='recipe" + ranNums[counter] + "' class='col-md-2'><h3>" + dayOfWeek[counter] + "</h3><a href='" + recipeLinks[ranNums[counter]] + "' target='_blank'>" + recipeNames[ranNums[counter]] + "</a><br><a href='" + recipeLinks[ranNums[counter]] + "' target='_blank'><img src='" + recipeImages[ranNums[counter]] + "' class='thumbnail' style='margin: 10px auto 0 auto' width='100' height='100'></a><br><a href='#' class='btn btn-default btn-xs'>Hold</a></div>");
                    counter++;
                  }
                });
                that.$el.fadeIn();
                $("#spinButtonHolder .btn-success").remove();
                $("#spinButtonHolder").append("<a href='#' id='reSpin' class='btn btn-success btn-lg'>Re-Spin!</a>");
              });
            },
            events: {
                'click .btn-default': 'holdRecipe',
                'click .re-spin': 'spinAgain'
            },
            holdRecipe: function(ev) {
              ev.preventDefault();
              $(ev.target).removeClass("btn-default").addClass("btn-primary");
            },
            spinAgain: function(ev) {
              ev.preventDefault();
              var storeRecipeIds = [];
              holdCounter = 0;
              $("div[id*='recipe']").each(function() {
                storeRecipeIds.push($(this).attr("id").substring(6));
                if($(this).children().hasClass("btn-default")) {
                  holdCounter++;
                }
              });
              var spinAgainRecipes = new Recipes();
              var spinAgainQuery = new Parse.Query(Recipe);
              var spinAgainRanNums = [];
              spinAgainQuery.count({
                success: function(count) {
                  while(spinAgainRanNums.length < holdCounter){
                    var randomnumber = Math.floor(Math.random() * count);
                    var found = false;
                    for (var i=0; i < spinAgainRanNums.length; i++){
                      if (spinAgainRanNums[i] == randomnumber) {
                        found = true;
                        break;
                      }
                    }
                    for (var i=0; i < storeRecipeIds.length; i++){
                      if (storeRecipeIds[i] == randomnumber) {
                        found = true;
                        break;
                      }
                    }
                    if (!found) {
                      spinAgainRanNums[spinAgainRanNums.length] = randomnumber;
                    }
                  }
                },
                error: function(error) {
                  alert("Oops! There was an error.");
                }
              });
              var recipeLinks = [];
              var recipeNames = [];
              var recipeImages = [];
              var counter = 0;
              spinAgainQuery.find().then(function(results) {
                _(results).each(function(recipe) {
                    recipeLinks.push(recipe.get("link"));
                    recipeNames.push(recipe.get("name"));
                    recipeImages.push(recipe.get("image").url());
                });
                $("div[id*='recipe']").each(function() {
                  if($(this).children().hasClass("btn-default")) {
                    $(this).fadeOut(function() {
                      $(this).attr("id", "recipe" + spinAgainRanNums[counter]);
                      $(this).children("a").not(".btn-xs").attr("href", recipeLinks[spinAgainRanNums[counter]]);
                      $(this).children("a:first-of-type").text(recipeNames[spinAgainRanNums[counter]]);
                      $(this).find("img").attr("src", recipeImages[spinAgainRanNums[counter]]);
                    counter++;
                    }).fadeIn();
                  }
                });
              });
            }
        });

        var Router = Backbone.Router.extend({
            routes: {
                '': 'home',
                'spin': 'spinResults'
            }
        });

        var spinResults = new SpinResults();

        var router = new Router();

        router.on('route:home', function () {

        });

        router.on('route:spinResults', function () {
            spinResults.render();
        });

        Backbone.history.start();

    </script>
    <script type="text/javascript">
      (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/platform.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
    </script>
  </body>
</html>

